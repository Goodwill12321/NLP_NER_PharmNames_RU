import csv
import json
import time
import re
import openai
from typing import List, Dict

import datetime
import httpx
from openai import RateLimitError  # Ensure correct import for RateLimitError


from tqdm import tqdm
from openai import OpenAI

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
INPUT_FILE = 'data/nlp_dataset_distinct_wo_col.csv'
ANNOTATION_FILE = 'data/or_annotated_deepseekr.jsonl'
VALIDATION_ERRORS_FILE = 'data/or_validation_errors_deepseekv.jsonl'
BATCH_SIZE = 30
ECHO_OUTPUT = False  # –ï—Å–ª–∏ True, –≤—ã–≤–æ–¥–∏—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤ stdout

# –ü—Ä–æ–º–ø—Ç—ã
SYSTEM_PROMPT = """–õ–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç—ã –∏–º–µ—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤, 
–∞ —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–¥–∞–Ω—ã –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è–º–∏ –∏ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è 
—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö, —Ç–∏–ø–∞ –ª–µ–∫. —Ñ–æ—Ä–º—ã, –¥–æ–∑–∏—Ä–æ–≤–∫–∏, –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —É–ø–∞–∫–æ–≤–∫–∞—Ö –∏ –ø—Ä. 
–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã —ç–∫—Å–ø–µ—Ä—Ç –ø—Ä–æ–≤–∏–∑–æ—Ä, —Ñ–∞—Ä–º–∞—Ü–µ–≤—Ç, –∑–Ω–∞–µ—à—å –æ–±—â–µ–ø—Ä–∏–Ω—è—Ç—ã–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ñ–æ—Ä–º 
–∏ –∫–∞–∫ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏ –¥–æ–∑–∏—Ä–æ–≤–∫–∏. 
–ù—É–∂–Ω–æ –ø–æ–º–æ—á—å –≤ —Ä–∞–∑–º–µ—Ç–∫–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π –∏–º–µ—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –ø–æ–ø–∞—Ä–Ω–æ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ, –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ), 
–∞ —Ç–∞–∫–∂–µ —á–∞—Å—Ç–µ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è. 

–£ –º–µ–Ω—è –µ—Å—Ç—å –¥–∞—Ç–∞—Å–µ—Ç –≤ –∫–æ—Ç–æ—Ä–æ–º 1-—è –∫–æ–ª–æ–Ω–∫–∞ –¢–æ–≤–∞—Ä–ü–æ—Å—Ç–∞–≤–∫–∏ –∏–º–µ–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é –Ω–µ —Å—Ç—Ä–æ–≥—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –ª–µ–∫.—Å—Ä–µ–¥—Å—Ç–≤–∞. 
2-—è –∫–æ–ª–æ–Ω–∫–∞, –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–¢–æ–≤–∞—Ä–∞ - —Ç–æ –∂–µ —Å–∞–º–æ–µ –ª–µ–∫.—Å—Ä–µ–¥—Å—Ç–≤–æ –∏–∑ –≥–æ—Å. —Ä–µ–µ—Å—Ç—Ä–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –ø–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏–∑ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö. 
–ß–∞—Å—Ç—å —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤ –¥—Ä—É–≥–∏—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö : 
–¢–æ—Ä–≥–æ–≤–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –î–æ–∑–∏—Ä–æ–≤–∫–∞, –õ–µ–∫—Ñ–æ—Ä–º–∞, –í—Ç–æ—Ä–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Ç.–¥.
–í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –ø—Ä–∏–≤–µ–¥–µ–Ω –¥–∞—Ç–∞—Å–µ—Ç, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ csv –≤ 1-–π —Å—Ç—Ä–æ–∫–µ -  –∑–∞–≥–æ–ª–æ–≤–∫–∏. 
–ï—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∏, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–µ—Å—è –Ω–∞ "_–¢–ü" - —ç—Ç–æ —á–∞—Å—Ç–∏ –¢–æ–≤–∞—Ä–∞–ü–æ—Å—Ç–∞–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã—è–≤–∏—Ç—å, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—è –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–¢–æ–≤–∞—Ä–∞ 
–µ–º—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –≤ —Å—Ç—Ä–æ–∫–µ –∏ —á–∞—Å—Ç–∏ –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–≤–æ–∞—Ä–∞ –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö, –ø—Ä–æ–≤–æ–¥—è –∞–Ω–∞–ª–æ–≥–∏—é —Ä–∞—Å–ø–ª–æ–∂–µ–Ω–∏—è —á–∞—Å—Ç–µ–π —Ç–æ–≤–∞—Ä–∞ 
–≤ –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏–¢–æ–≤–∞—Ä–∞. –í —ç—Ç–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö –Ω–∏–∂–µ —è –≤—ã—è–≤–∏–ª —ç—Ç–∏ —á–∞—Å—Ç–∏. :

–¢–æ–≤–∞—Ä–ü–æ—Å—Ç–∞–≤–∫–∏,–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–¢–æ–≤–∞—Ä–∞,–¢–æ—Ä–≥–æ–≤–æ–µ–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ,–¢–æ—Ä–≥–æ–≤–æ–µ–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ_–¢–ü,–î–æ–∑–∏—Ä–æ–≤–∫–∞,–î–æ–∑–∏—Ä–æ–≤–∫–∞_–¢–ü,–õ–µ–∫–§–æ—Ä–º–∞,–õ–µ–∫—Ñ–æ—Ä–º–∞_–¢–ü,–ü–µ—Ä–≤–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ù–∞–∑–≤–∞–Ω–∏–µ,–ü–µ—Ä–≤–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ù–∞–∑–≤–∞–Ω–∏–µ_–¢–ü,–ü–µ—Ä–≤–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ,–ü–µ—Ä–≤–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ_–¢–ü,–î–æ–∑–∏—Ä–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ,–î–æ–∑–∏—Ä–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ_–¢–ü,–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–≤–æ,–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–≤–æ_–¢–ü,–í—Ç–æ—Ä–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ù–∞–∑–≤–∞–Ω–∏–µ,–í—Ç–æ—Ä–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ù–∞–∑–≤–∞–Ω–∏–µ_–¢–ü,–í—Ç–æ—Ä–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ,–í—Ç–æ—Ä–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ_–¢–ü
9 –º–µ—Å—è—Ü–µ–≤ –§–æ–ª–∏–µ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞ —Ç–∞–±–ª –ø/–æ –ø–ª–µ–Ω 400 –º–∫–≥ —Ö30,"9 –º–µ—Å—è—Ü–µ–≤ –§–æ–ª–∏–µ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞ —Ç–∞–±–ª–µ—Ç–∫–∏, –ø–æ–∫—Ä—ã—Ç—ã–µ –ø–ª–µ–Ω–æ—á–Ω–æ–π –æ–±–æ–ª–æ—á–∫–æ–π, 400 –º–∫–≥, 10 —à—Ç. - —É–ø–∞–∫–æ–≤–∫–∏ —è—á–µ–π–∫–æ–≤—ã–µ –∫–æ–Ω—Ç—É—Ä–Ω—ã–µ (3)  - –ø–∞—á–∫–∏ –∫–∞—Ä—Ç–æ–Ω–Ω—ã–µ",9 –º–µ—Å—è—Ü–µ–≤ –§–æ–ª–∏–µ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞,9 –º–µ—Å—è—Ü–µ–≤ –§–æ–ª–∏–µ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞,400 –º–∫–≥,400 –º–∫–≥,"–¢–ê–ë–õ–ï–¢–ö–ò, –ü–û–ö–†–´–¢–´–ï –û–ë–û–õ–û–ß–ö–û–ô",,–£–ü–ê–ö–û–í–ö–ê –Ø–ß–ï–ô–ö–û–í–ê–Ø –ö–û–ù–¢–£–†–ù–ê–Ø,,10,,0,,30,30,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,3,
LIBELL/–õ–ò–ë–≠–õ–¨ –°–ø–∏—Ä–∞–ª–∏ –æ—Ç –∫–æ–º–∞—Ä–æ–≤ —á–µ—Ä–Ω 602573,"L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç –ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø 1 –º–≥/–º–ª (5) –ê–ú–ü–£–õ–´,  (10) –ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê",L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç,LIBELL/–õ–ò–ë–≠–õ–¨ –°–ø–∏—Ä–∞–ª–∏ –æ—Ç –∫–æ–º–∞—Ä–æ–≤,1 –º–≥/–º–ª,,–ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø,,–ê–ú–ü–£–õ–´,,5,,,0,,50,,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,10
"L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç 0,001/–º–ª 5 –º–ª ‚Ññ10 –∞–º–ø*","L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç –ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø 1 –º–≥/–º–ª (5) –ê–ú–ü–£–õ–´,  (10) –ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê",L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç,L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç,1 –º–≥/–º–ª,"0,001/–º–ª",–ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø,,–ê–ú–ü–£–õ–´,–∞–º–ø,5,5,,0,,50,,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,10
"L-–õ–ò–ó–ò–ù–ê –≠–°–¶–ò–ù–ê–¢ 0,001/–ú–õ 5–ú–õ N10 –ê–ú–ü –ö–û–ù–¶ –î/–†-–†–ê –í/–í/–û–ó–û–ù","L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç –ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø 1 –º–≥/–º–ª (5) –ê–ú–ü–£–õ–´,  (10) –ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê",L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç,L-–õ–ò–ó–ò–ù–ê –≠–°–¶–ò–ù–ê–¢,1 –º–≥/–º–ª,"0,001/–ú–õ",–ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø,–ö–û–ù–¶ –î/–†-–†–ê –í/–í,–ê–ú–ü–£–õ–´,–ê–ú–ü,5,5,,0,,50,,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,10
L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç –∫–æ–Ω—Ü –¥/–ø—Ä–∏–≥ —Ä-—Ä–∞ –≤/–≤ –≤–≤–µ–¥ 1 –º–≥/–º–ª –∞–º–ø 5 –º–ª —Ö10,"L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç –ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø 1 –º–≥/–º–ª (5) –ê–ú–ü–£–õ–´,  (10) –ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê",L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç,L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç,1 –º–≥/–º–ª,1 –º–≥/–º–ª ,–ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø,–∫–æ–Ω—Ü –¥/–ø—Ä–∏–≥ —Ä-—Ä–∞ –≤/–≤ –≤–≤–µ–¥,–ê–ú–ü–£–õ–´,–∞–º–ø,5,5,,0,,50,,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,10
L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç –∫–æ–Ω—Ü –¥/–ø—Ä–∏–≥ —Ä-—Ä–∞ –≤/–≤ –≤–≤–µ–¥ 1–º–≥/–º–ª 5–º–ª –∞–º–ø ‚Ññ10,"L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç –ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø 1 –º–≥/–º–ª (5) –ê–ú–ü–£–õ–´,  (10) –ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê",L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç,L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç,1 –º–≥/–º–ª,1 –º–≥/–º–ª ,–ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø,–∫–æ–Ω—Ü –¥/–ø—Ä–∏–≥ —Ä-—Ä–∞ –≤/–≤ –≤–≤–µ–¥,–ê–ú–ü–£–õ–´,–∞–º–ø,5,5,0,,50,,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,10,10
L-–õ–ò–ó–ò–ù–ê –≠–°–¶–ò–ù–ê–¢ –ö–û–ù–¶. –î/–ü–†–ò–ì. –†-–†–ê –î–õ–Ø –í/–í –í–í–ï–î. 1–ú–ì/–ú–õ –ê–ú–ü. 5–ú–õ ‚Ññ10,"L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç –ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø 1 –º–≥/–º–ª (5) –ê–ú–ü–£–õ–´,  (10) –ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê",L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç,L-–õ–ò–ó–ò–ù–ê –≠–°–¶–ò–ù–ê–¢,1 –º–≥/–º–ª,1–ú–ì/–ú–õ,–ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø,–ö–û–ù–¶. –î/–ü–†–ò–ì. –†-–†–ê –î–õ–Ø –í/–í –í–í–ï–î,–ê–ú–ü–£–õ–´,–ê–ú–ü,5,5,,0,,50,,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,10
L-–õ–∏–∑–∏–Ω–∞-—ç—Å—Ü–∏–Ω–∞—Ç (–∫–æ–Ω—Ü –¥/–ø—Ä–∏–≥ —Ä-—Ä–∞ –¥–ª—è –≤/–≤ –≤–≤–µ–¥–µ–Ω 1–º–≥/–º–ª 5 –º–ª ‚Ññ10 –∞–º–ø. –ø/–∫–∞—Ä—Ç. ),"L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç –ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø 1 –º–≥/–º–ª (5) –ê–ú–ü–£–õ–´,  (10) –ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê",L-–õ–∏–∑–∏–Ω–∞ —ç—Å—Ü–∏–Ω–∞—Ç,L-–õ–∏–∑–∏–Ω–∞-—ç—Å—Ü–∏–Ω–∞—Ç,1 –º–≥/–º–ª,1–º–≥/–º–ª,–ö–û–ù–¶–ï–ù–¢–†–ê–¢ –î–õ–Ø –ü–†–ò–ì–û–¢–û–í–õ–ï–ù–ò–Ø –†–ê–°–¢–í–û–†–ê –î–õ–Ø –í–ù–£–¢–†–ò–í–ï–ù–ù–û–ì–û –í–í–ï–î–ï–ù–ò–Ø,–∫–æ–Ω—Ü –¥/–ø—Ä–∏–≥ —Ä-—Ä–∞ –¥–ª—è –≤/–≤ –≤–≤–µ–¥–µ–Ω ,–ê–ú–ü–£–õ–´,–∞–º–ø,5,5,0,,50,,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,10,10
L-–¢–ò–†–û–ö–°–ò–ù 100–ú–ö–ì N100 –¢–ê–ë–õ,"L-–¢–∏—Ä–æ–∫—Å–∏–Ω —Ç–∞–±–ª–µ—Ç–∫–∏, 0.1 –º–≥, 50 —à—Ç. - —É–ø–∞–∫–æ–≤–∫–∏ —è—á–µ–π–∫–æ–≤—ã–µ –∫–æ–Ω—Ç—É—Ä–Ω—ã–µ (2)  - –ø–∞—á–∫–∏ –∫–∞—Ä—Ç–æ–Ω–Ω—ã–µ",L-–¢–∏—Ä–æ–∫—Å–∏–Ω,L-–¢–ò–†–û–ö–°–ò–ù,100 –º–∫–≥,100–ú–ö–ì,–¢–ê–ë–õ–ï–¢–ö–ò,–¢–ê–ë–õ,–£–ü–ê–ö–û–í–ö–ê –Ø–ß–ï–ô–ö–û–í–ê–Ø –ö–û–ù–¢–£–†–ù–ê–Ø,,50,,0,,100,100,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,2,
L-–¢–ò–†–û–ö–°–ò–ù 150 –ë–ï–†–õ–ò–ù-–•–ï–ú–ò N100 –¢–ê–ë–õ,"L-–¢–∏—Ä–æ–∫—Å–∏–Ω 150 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏ —Ç–∞–±–ª–µ—Ç–∫–∏, 150 –º–∫–≥, 25 —à—Ç. - –∫–æ–Ω—Ç—É—Ä–Ω–∞—è —è—á–µ–π–∫–æ–≤–∞—è —É–ø–∞–∫–æ–≤–∫–∞ (–±–ª–∏—Å—Ç–µ—Ä) (4)  - –ø–∞—á–∫–∞  –∫–∞—Ä—Ç–æ–Ω–Ω–∞—è",L-–¢–∏—Ä–æ–∫—Å–∏–Ω 150 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏,L-–¢–ò–†–û–ö–°–ò–ù 150 –ë–ï–†–õ–ò–ù-–•–ï–ú–ò,150 –º–∫–≥,,–¢–ê–ë–õ–ï–¢–ö–ò,–¢–ê–ë–õ,–ë–õ–ò–°–¢–ï–†,,25,,0,,100,100,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,4,
L-–¢–ò–†–û–ö–°–ò–ù 50 –ë–ï–†–õ–ò–ù-–•–ï–ú–ò N50 –¢–ê–ë–õ,"L-–¢–∏—Ä–æ–∫—Å–∏–Ω 50 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏ —Ç–∞–±–ª–µ—Ç–∫–∏, 50 –º–∫–≥, 25 —à—Ç. - –±–ª–∏—Å—Ç–µ—Ä (2)  - –ø–∞—á–∫–∞ –∫–∞—Ä—Ç–æ–Ω–Ω–∞—è",L-–¢–∏—Ä–æ–∫—Å–∏–Ω 50 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏,L-–¢–ò–†–û–ö–°–ò–ù 50 –ë–ï–†–õ–ò–ù-–•–ï–ú–ò,50 –º–∫–≥,,–¢–ê–ë–õ–ï–¢–ö–ò,–¢–ê–ë–õ,–ë–õ–ò–°–¢–ï–†,,25,,0,,50,50,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,2,
L-–¢–∏—Ä–æ–∫—Å–∏–Ω 50 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏ —Ç–∞–± 50 –º–∫–≥ ‚Ññ50,"L-–¢–∏—Ä–æ–∫—Å–∏–Ω 50 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏ —Ç–∞–±–ª–µ—Ç–∫–∏, 50 –º–∫–≥, 25 —à—Ç. - –±–ª–∏—Å—Ç–µ—Ä (2)  - –ø–∞—á–∫–∞ –∫–∞—Ä—Ç–æ–Ω–Ω–∞—è",L-–¢–∏—Ä–æ–∫—Å–∏–Ω 50 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏,L-–¢–∏—Ä–æ–∫—Å–∏–Ω 50 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏,50 –º–∫–≥,50 –º–∫–≥,–¢–ê–ë–õ–ï–¢–ö–ò,—Ç–∞–±,–ë–õ–ò–°–¢–ï–†,,25,,0,,50,50,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,2,
L-–¢–∏—Ä–æ–∫—Å–∏–Ω 50 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏ —Ç–∞–±. 50–º–∫–≥ ‚Ññ50,"L-–¢–∏—Ä–æ–∫—Å–∏–Ω 50 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏ —Ç–∞–±–ª–µ—Ç–∫–∏, 50 –º–∫–≥, 25 —à—Ç. - –∫–æ–Ω—Ç—É—Ä–Ω–∞—è —è—á–µ–π–∫–æ–≤–∞—è —É–ø–∞–∫–æ–≤–∫–∞ (–±–ª–∏—Å—Ç–µ—Ä) (2)  - –ø–∞—á–∫–∞ –∫–∞—Ä—Ç–æ–Ω–Ω–∞—è",L-–¢–∏—Ä–æ–∫—Å–∏–Ω 50 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏,L-–¢–∏—Ä–æ–∫—Å–∏–Ω 50 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏ ,50 –º–∫–≥,50–º–∫–≥,–¢–ê–ë–õ–ï–¢–ö–ò,—Ç–∞–±,–ë–õ–ò–°–¢–ï–†,,25,,0,,50,50,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,2,
L-–¢–∏—Ä–æ–∫—Å–∏–Ω 75 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏ (—Ç–∞–±. 75 –º–∫–≥ ‚Ññ100 –±–ª–∏—Å—Ç. –ø–∞—á/ –∫–∞—Ä—Ç ),"L-–¢–∏—Ä–æ–∫—Å–∏–Ω 75 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏ —Ç–∞–±–ª–µ—Ç–∫–∏, 75 –º–∫–≥, 25 —à—Ç. - –∫–æ–Ω—Ç—É—Ä–Ω–∞—è —è—á–µ–π–∫–æ–≤–∞—è  —É–ø–∞–∫–æ–≤–∫–∞ (–±–ª–∏—Å—Ç–µ—Ä) (4)  - –ø–∞—á–∫–∞  –∫–∞—Ä—Ç–æ–Ω–Ω–∞—è",L-–¢–∏—Ä–æ–∫—Å–∏–Ω 75 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏,L-–¢–∏—Ä–æ–∫—Å–∏–Ω 75 –ë–µ—Ä–ª–∏–Ω-–•–µ–º–∏,75 –º–∫–≥,75 –º–∫–≥,–¢–ê–ë–õ–ï–¢–ö–ò,—Ç–∞–±,–ë–õ–ò–°–¢–ï–†,–±–ª–∏—Å—Ç,25,,0,,100,,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,–ø–∞—á,4,
"–ê–≤–∞–º–∏—Å (—Å–ø—Ä–µ–π –Ω–∞–∑–∞–ª. –¥–æ–∑–∏—Ä–æ–≤. 27,5 –º–∫–≥/–¥–æ–∑–∞ 120–¥–æ–∑ —Ñ–ª/–ø–∞—á. –∫–∞—Ä—Ç. )","–ê–≤–∞–º–∏—Å –°–ü–†–ï–ô –ù–ê–ó–ê–õ–¨–ù–´–ô –î–û–ó–ò–†–û–í–ê–ù–ù–´–ô 27.5 –º–∫–≥/–¥–æ–∑–∞ (120) –§–õ–ê–ö–û–ù,  (1) –ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê",–ê–≤–∞–º–∏—Å,–ê–≤–∞–º–∏—Å,27.5 –º–∫–≥/–¥–æ–∑–∞,"27,5 –º–∫–≥/–¥–æ–∑–∞",–°–ü–†–ï–ô –ù–ê–ó–ê–õ–¨–ù–´–ô –î–û–ó–ò–†–û–í–ê–ù–ù–´–ô,—Å–ø—Ä–µ–π –Ω–∞–∑–∞–ª. –¥–æ–∑–∏—Ä–æ–≤.,–§–õ–ê–ö–û–ù,—Ñ–ª,120,,0,,120,120,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,–ø–∞—á.–∫–∞—Ä—Ç.,1,
"–ê–ì–û–ú–ï–õ–ê–¢–ò–ù 0,025 N28 –¢–ê–ë–õ –ü/–ü–õ–ï–ù/–û–ë–û–õ–û–ß","–ê–≥–æ–º–µ–ª–∞—Ç–∏–Ω —Ç–∞–±–ª–µ—Ç–∫–∏, –ø–æ–∫—Ä—ã—Ç—ã–µ –ø–ª–µ–Ω–æ—á–Ω–æ–π –æ–±–æ–ª–æ—á–∫–æ–π, 25 –º–≥, 14 —à—Ç. - —É–ø–∞–∫–æ–≤–∫–∏ —è—á–µ–π–∫–æ–≤—ã–µ –∫–æ–Ω—Ç—É—Ä–Ω—ã–µ (2)  - –ø–∞—á–∫–∏ –∫–∞—Ä—Ç–æ–Ω–Ω—ã–µ",–ê–≥–æ–º–µ–ª–∞—Ç–∏–Ω,–ê–ì–û–ú–ï–õ–ê–¢–ò–ù,25 –º–≥,25,"–¢–ê–ë–õ–ï–¢–ö–ò, –ü–û–ö–†–´–¢–´–ï –û–ë–û–õ–û–ß–ö–û–ô",–¢–ê–ë–õ –ü/–ü–õ–ï–ù/–û–ë–û–õ–û–ß,–£–ü–ê–ö–û–í–ö–ê –Ø–ß–ï–ô–ö–û–í–ê–Ø –ö–û–ù–¢–£–†–ù–ê–Ø,,14,,25,,28,28,–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê,,2,

–í –≤—ã—Ö–æ–¥–Ω–æ–º json –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å  –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∞–∏ –∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö —Å—Ç—Ä–æ–∫ csv —Ñ–∞–π–ª–∞, –∫–æ—Ç–æ—Ä—ã–π —è –¥–∞–º. –ù–∞ –ø–µ—Ä–≤–æ–º —É—Ä–æ–≤–Ω–µ 
 –≤—ã–±–∏—Ä–∞—Ç—å –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–∫–∏, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏–µ—Å—è –Ω–∞ "_–¢–ü", –∞ —Ç–∞–∫–∂–µ –ø–µ—Ä–≤—ã–º  –∞—Ç—Ä–∏–±—É—Ç–æ–º  –¥–æ–±–∞–≤–ª–µ–Ω  –ì–£–ò–î_–ó–∞–ø–∏—Å–∏ - —Å–ª—É—á–∞–π–Ω—ã–π –ì–£–ò–î, 
 —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –±—ã–ª–æ –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –µ–µ. –ó–∞–ø–æ–ª–Ω—è—Ç—å –Ω—É–∂–Ω–æ  —á–∞—Å—Ç—è–º–∏ –¢–æ–≤–∞—Ä–∞–ü–æ—Å—Ç–∞–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–¥–µ–ª–µ–Ω—ã –∏–∑ –¢–æ–≤–∞—Ä–∞–ü–æ—Å—Ç–∞–≤–∫–∏ 
 –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –≤—ã–¥–µ–ª–µ–Ω–∏—è —á–∞—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –≤–∑—è—Ç—ã –∏–∑ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã—Ö –≤—ã—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤.
–ù–∞–ø—Ä–∏–º–µ—Ä (–∑–¥–µ—Å—å –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ—Å—Ç–æ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–ª–æ–Ω–æ–∫ json. –í –ø—Ä–∏–º–µ—Ä–µ —Å–∏–º–≤–æ–ª–æ–º ... 
—É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ —Ç–∞–º –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ –¥–∞–ª–µ–µ —Ç–∞–∫–∂–µ. 
–¢–µ –∫–æ–ª–æ–Ω–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É–¥–∞—Å—Ç—Å—è –Ω–∞–π—Ç–∏ –≤ –¢–æ–≤–∞—Ä–µ–ü–æ—Å—Ç–∞–≤–∫–∏, –æ—Å—Ç–∞–≤–ª—è—Ç—å –ø—É—Å—Ç—ã–º–∏) : "[
   {   "–ì–£–ò–î_–ó–∞–ø–∏—Å–∏": "1fa2b3c4-5678-90ab-cdef-1234567890ab",
       "–¢–æ–≤–∞—Ä–ü–æ—Å—Ç–∞–≤–∫–∏": "–ê–¥–∂–∏—Å–µ–ø—Ç (—Ç–∞–±. –¥/—Ä–∞—Å—Å–∞—Å. –∞–Ω–∞–Ω–∞—Å–æ–≤—ã–µ ‚Ññ24 —Å—Ç—Ä–∏–ø—ã –ø–∞—á.–∫–∞—Ä—Ç. )",
       "–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–¢–æ–≤–∞—Ä–∞" : "–ê–¥–∂–∏—Å–µ–ø—Ç –¢–ê–ë–õ–ï–¢–ö–ò –î–õ–Ø –†–ê–°–°–ê–°–´–í–ê–ù–ò–Ø 0.6 –º–≥+1.2 –º–≥ (6) –°–¢–†–ò–ü–´,  (4) –ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê",
       "–¢–æ—Ä–≥–æ–≤–æ–µ–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ_–¢–ü": "–ê–¥–∂–∏—Å–µ–ø—Ç",
       "–õ–µ–∫—Ñ–æ—Ä–º–∞_–¢–ü": "—Ç–∞–± –¥/—Ä–∞—Å—Å–∞—Å.",
       "–ü–µ—Ä–≤–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ù–∞–∑–≤–∞–Ω–∏–µ_–¢–ü": "—Å—Ç—Ä–∏–ø—ã",
       "–í—Ç–æ—Ä–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ù–∞–∑–≤–∞–Ω–∏–µ_–¢–ü": "–ø–∞—á.–∫–∞—Ä—Ç.",
       "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∞—è–£–ø–∞–∫–æ–≤–∫–∞_–¢–ü": 24,
       –ò—Å—Ö–æ–¥–Ω—ã–µ–î–∞–Ω–Ω—ã–µ: {
           "–¢–æ—Ä–≥–æ–≤–æ–µ–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ê–¥–∂–∏—Å–µ–ø—Ç",
           "–õ–µ–∫–§–æ—Ä–º–∞": "–¢–ê–ë–õ–ï–¢–ö–ò –î–õ–Ø –†–ê–°–°–ê–°–´–í–ê–ù–ò–Ø",
           "–ü–µ—Ä–≤–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ù–∞–∑–≤–∞–Ω–∏–µ": "–°–¢–†–ò–ü–´",
           "–ü–µ—Ä–≤–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": 6,
           "–í—Ç–æ—Ä–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ù–∞–∑–≤–∞–Ω–∏–µ": "–ö–ê–†–¢–û–ù–ù–ê–Ø –ü–ê–ß–ö–ê",
           "–í—Ç–æ—Ä–∏—á–Ω–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": 4,
           "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ù–∞–∑–≤–∞–Ω–∏–µ": "–£–ü–ê–ö–û–í–ö–ê –Ø–ß–ï–ô–ö–û–í–ê–Ø –ö–û–ù–¢–£–†–ù–ê–Ø",
           "–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ": 24,
           "–î–æ–∑–∏—Ä–æ–≤–∫–∞": "0.6 –º–≥+1.2 –º–≥",
           ...
       },
   },
   ...
]"  –í–ê–ñ–ù–û! - —ç—Ç–∏ —á–∞—Å—Ç–∏ (—Ç.–µ. —Ä–µ–∫–≤–∏–∑–∏—Ç—ã json —Å –ø–æ—Å—Ç—Ñ–∏–∫—Å–æ–º _–¢–ü) –º–æ–≥—É—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –≤–∑—è—Ç—ã –∏–∑ –¢–æ–≤–∞—Ä–∞–ü–æ—Å—Ç–∞–≤–∫–∏, –Ω–µ–ª—å–∑—è –±—Ä–∞—Ç—å –∏—Ö –æ—Ç–∫—É–¥–∞-—Ç–æ –µ—â–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ –∏–ª–∏ –¥–æ–¥—É–º—ã–≤–∞—Ç—å!
 –ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å —Ç–∞–∫:
   "–¢–æ–≤–∞—Ä–ü–æ—Å—Ç–∞–≤–∫–∏": "–ê–¥–µ–º–µ—Ç–∏–æ–Ω–∏–Ω —Ç–∞–±–ª –∫–∏—à–µ—á–Ω–æ—Ä–∞—Å—Ç –ø/–æ –ø–ª–µ–Ω 400 –º–≥ —Ö20", 
    "–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–¢–æ–≤–∞—Ä–∞": "–ê–¥–µ–º–µ—Ç–∏–æ–Ω–∏–Ω —Ç–∞–±–ª–µ—Ç–∫–∏ –∫–∏—à–µ—á–Ω–æ—Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–µ, –ø–æ–∫—Ä—ã—Ç—ã–µ –ø–ª–µ–Ω–æ—á–Ω–æ–π –æ–±–æ–ª–æ—á–∫–æ–π, 400 –º–≥, 10 —à—Ç. - –∫–æ–Ω—Ç—É—Ä–Ω–∞—è —è—á–µ–π–∫–æ–≤–∞—è —É–ø–∞–∫–æ–≤–∫–∞ (2)  - –ø–∞—á–∫–∞ –∫–∞—Ä—Ç–æ–Ω–Ω–∞—è", 
    "–õ–µ–∫–§–æ—Ä–º–∞_–¢–ü": "–¢–ê–ë–õ–ï–¢–ö–ò, –ü–û–ö–†–´–¢–´–ï –û–ë–û–õ–û–ß–ö–û–ô",
–∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å
"–õ–µ–∫–§–æ—Ä–º–∞_–¢–ü": "—Ç–∞–±–ª –∫–∏—à–µ—á–Ω–æ—Ä–∞—Å—Ç –ø/–æ –ø–ª–µ–Ω", 
—Ç–∞–∫ –∫–∞–∫ –≤ –¢–æ–≤–∞—Ä–µ–ü–æ—Å—Ç–∞–≤–∫–µ –∑–∞–ø–∏—Å–∞–Ω–æ –∏–º–µ–Ω–Ω–æ —Ç–∞–∫! –≠—Ç–æ —Å—Ç–æ—Ä–æ–≥–æ–µ –ø—Ä–∞–≤–∏–ª–æ! –ù–µ–ª—å–∑—è –≤—ã–±–∏—Ä–∞—Ç—å —á—Ç–æ-—Ç–æ –∏–∑ –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–¢–æ–≤–∞—Ä–∞ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∫–æ–ª–æ–Ω–æ–∫!
–ù—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –∫–∞–∫–∞—è —á–∞—Å—Ç—å —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å—Ç–∞–≤–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–∑–∏—Ä–æ–≤–∫–æ–π, –ª–µ–∫—Ñ–æ—Ä–º–æ–π, –ø–æ—Ç—Ä–µ–±–∏—Ç. —É–ø–∞–∫–æ–≤–∫–æ–π –∏ —Ç.–¥.
–û—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–æ–ª–æ–Ω–∫–∏ –º–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ò—Å—Ö–æ–¥–Ω—ã–µ–î–∞–Ω–Ω—ã–µ –≤ –∫–æ—Ç–æ—Ä–æ–π –ø–µ—Ä–≤—ã–π —Ä–µ–∫–≤–∏–∑–∏—Ç : –¢–æ—Ä–≥–æ–≤–æ–µ–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –õ–µ–∫–§–æ—Ä–º–∞ –∏ –ø–æ—Ç–æ–º –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ –∫–∞–∫ –≤ —Ñ–∞–π–ª–µ) 
    - —ç—Ç–æ –æ–ø–æ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–æ—Ç–æ—Ä—ã–º –º–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–Ω—è—Ç—å –∫–∞–∫ —Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å—á–µ—Ç–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ —Å –ø–æ—Å—Ç—Ñ–∏–∫—Å–æ–º _–¢–ü) –∏ –ø–æ –∫–æ—Ç–æ—Ä—ã–º –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
–ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤ –¢–æ–≤–∞—Ä–µ–ü–æ—Å—Ç–∞–≤–∫–∏ —Å–∏–º–≤–æ–ª ‚Ññ –∏–ª–∏ —Ö —Å —Ü–∏—Ñ—Ä–æ–π, —Ç–æ —ç—Ç–æ –æ–±—ã—á–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–æ–π —É–ø–∞–∫–æ–≤–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä ‚Ññ12 - —ç—Ç–æ –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∞—è–£–ø–∞–∫–æ–≤–∫–∞–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ = 12). 
–ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ –ø–µ—Ä–≤–∏—á–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–µ –æ–±—ã—á–Ω–æ —Å –µ–¥–∏–Ω–∏—Ü–∞–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è ("–º–ª" –∏ —Ç.–¥.) 
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–æ–π —É–ø–∞–∫–æ–≤–∫–µ –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ —Å—á–∏—Ç–∞—é—Ç—Å—è –∫–∞–∫ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ –ø–µ—Ä–≤–∏—á–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–µ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ —É–ø–∞–∫–æ–≤–∫–µ –≤—Ç–æ—Ä–∏—á–Ω–æ–π. 
–ó–Ω–∞—á–∏—Ç –≤—Ç–æ—Ä–∏—á–Ω—É—é –º–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–∞–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–æ–π —É–ø–∞–∫–æ–≤–∫–µ / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –ø–µ—Ä–≤–∏—á–Ω–æ–π —É–ø–∞–∫–æ–≤–∫–µ.
–õ—é–±—ã–µ –ø–æ–ª—è —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞–º–∏ –±–µ–∑ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä 10, –∞ –Ω–µ 10 —à—Ç. –∏–ª–∏ 10 –º–ª., –µ–¥–∏–Ω–∏—Ü—ã –Ω—É–∂–Ω–æ –≤—ã–¥–µ–ª—è—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ 
—Ä–µ–∫–≤–∏–∑–∏—Ç—ã, –µ—Å–ª–∏ —É–¥–∞—Å—Ç—Å—è –∏—Ö –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å
–í–æ–∑–≤—Ä–∞—â–∞–π —Ç–æ–ª—å–∫–æ json —Ñ–∞–π–ª –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π, —á—Ç–æ–±—ã —è –º–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ. –¢–∞–∫–∂–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –Ω–∏–∫–∞–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤, 
–∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è json –∫–æ–¥–∏—Ä–æ–≤–æ–∫–æ–π —Ç–∏–ø–∞ —Å—Ç–µ–ø–µ–Ω–∏ 3 (–¥–ª—è –∫—É–±–∏—á–µ—Å–∫–∏—Ö —Å–º - –ª—É—á—à–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è —Å—Ç–µ–ø–µ–Ω–∏ ^),
–ï—â–µ —Ä–∞–∑. –≠—Ç–æ –≤–∞–∂–Ω–æ! –≤ –æ—Ç–≤–µ–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∏–∫–∞–∫–∏—Ö –ø–æ—è—Å–Ω–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ json —Ñ–∞–π–ª –¶–ï–õ–ò–ö–û–ú —Ü–µ–ª–æ—Å—Ç–Ω—ã–π, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –¥–æ –∫–æ–Ω—Ü–∞, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä—ã.
"""


validation_system_prompt = (
    "–¢—ã ‚Äî –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π —Ñ–∞–æ–º–∞—Ü–µ–≤—Ç, –ø—Ä–æ–≤–∏–∑–æ—Ä. –î—Ä—É–≥–æ–π –º–æ–¥–µ–ª–∏ –±—ã–ª–æ –¥–∞–Ω–æ –∑–∞–¥–∞–Ω–∏–µ: "
    + SYSTEM_PROMPT
    + ". –ù–∞ –≤—Ö–æ–¥–µ —Ç–µ–±–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –±—É–¥—É—Ç –¥–∞–Ω—ã –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –≤—ã–¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–π –º–æ–¥–µ–ª—å—é. (–≤–∫–ª—é—á–∞—è –æ–±—Ä–∞–º–ª—è—é—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏) "
    + "–ù–∞–π–¥–∏ –æ—à–∏–±–∫–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª (–Ω–∞ –æ—à–∏–±–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã json –Ω–µ –æ–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏—è!) –∏ –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π –∏—Ö, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å, –ø—Ä–∏–≤–µ–¥—è –≥—É–∏–¥—ã –∑–∞–ø–∏—Å–µ–π –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ—à–∏–±–∫–∏ "
    + "(–±—Ä–∞—Ç—å –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–µ –ì–£–ò–î_–ó–∞–ø–∏—Å–∏). –ù–µ –∏–∑–º–µ–Ω—è–π —Å–∞–º—É –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é."
)


MODEL_ANNOTATE = "deepseek/deepseek-r1:free"  # –∏–ª–∏ "deepseek-moe:13b"

# meta-llama/llama-3.3-8b-instruct:free
# tngtech/deepseek-r1t-chimera:free
#
MODEL_VALIDATE = "deepseek/deepseek-chat-v3-0324:free"
def read_csv_rows(path: str) -> List[Dict[str, str]]:
    with open(path, encoding='cp1251') as f:
        reader = csv.DictReader(f)
        return list(reader)

client = OpenAI(
    base_url="https://openrouter.ai/api/v1",
    api_key="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",
)

def batch_rows(rows: List[Dict[str, str]], size: int) -> List[List[Dict[str, str]]]:
    return [rows[i:i+size] for i in range(0, len(rows), size)]

def rows_to_csv_block(rows: List[Dict[str, str]], headers: List[str]) -> str:
    output = ",".join(headers) + "\n"
    for row in rows:
        output += ",".join(row.get(h, "") for h in headers) + "\n"
    return output.strip()

import time
import datetime
import httpx
import traceback
import logging

def sanitize_user_prompt(prompt: str) -> str:
    """
    –£–¥–∞–ª—è–µ—Ç —Å–∏–º–≤–æ–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å JSONDecodeError –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ user_prompt.
    """
    # –£–¥–∞–ª—è–µ–º —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–º–≤–æ–ª—ã –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º \n, \r, \t
    cleaned = ''.join(
        ch for ch in prompt
        if ch in ('\n', '\r', '\t') or ord(ch) >= 0x20
    )
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤ JSON
    try:
        json.dumps(cleaned)
        return cleaned
    except UnicodeEncodeError:
        # –£–¥–∞–ª—è–µ–º –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã Unicode (—Ä–µ–¥–∫–æ)
        cleaned = cleaned.encode('utf-8', 'ignore').decode('utf-8')
        return cleaned
    except Exception as e:
        # –ù–∞ —Å–ª—É—á–∞–π –¥—Ä—É–≥–∏—Ö —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
        print(f"Unexpected serialization issue: {e}")
        return re.sub(r'[^\x20-\x7E\n\r\t]', '', cleaned)  # ASCII-safe fallback
    
def call_openrouter(model, system_prompt: str, user_prompt: str, comment="") -> str:
   
    user_prompt = sanitize_user_prompt(user_prompt)
    if not user_prompt:
        print("‚ùó –ü—É—Å—Ç–æ–π user_prompt, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—ã–∑–æ–≤ –º–æ–¥–µ–ª–∏.")
        return ""   
    while True:
        try:
            if ECHO_OUTPUT:
                # –†–µ–∂–∏–º –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
                stream = client.chat.completions.create(
                    model=model,
                    messages=[
                        {"role": "system", "content": system_prompt},
                        {"role": "user", "content": user_prompt}
                    ],
                    temperature=0.0,
                    stream=True
                )

                full_response = ""
                print("–û—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ (–ø–æ—Ç–æ–∫–æ–≤—ã–π) (" + comment + ") :")
                for chunk in stream:
                    if chunk.choices[0].delta.content:
                        content = chunk.choices[0].delta.content
                        print(content, end='', flush=True)
                        full_response += content
                return full_response

            else:
                # –û–±—ã—á–Ω—ã–π (–Ω–µ—Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π) –æ—Ç–≤–µ—Ç ‚Äî –∑–¥–µ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏
                response = client.chat.completions.create(
                    model=model,
                    messages=[
                        {"role": "system", "content": system_prompt},
                        {"role": "user", "content": user_prompt}
                    ],
                    temperature=0.0,
                    stream=False
                )

                # –ü–µ—á–∞—Ç–∞–µ–º –ª–∏–º–∏—Ç—ã, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
                if hasattr(response, 'response') and hasattr(response.response, 'headers'):
                    headers = response.response.headers
                    limit = headers.get("X-RateLimit-Limit")
                    remaining = headers.get("X-RateLimit-Remaining")
                    reset = headers.get("X-RateLimit-Reset")
                    if limit and remaining and reset:
                        reset_time = datetime.datetime.fromtimestamp(int(reset) / 1000).strftime('%H:%M:%S')
                        print(f"üîÑ –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤: {remaining} –∏–∑ {limit}. –°–±—Ä–æ—Å –ª–∏–º–∏—Ç–∞ –≤ {reset_time}.")

                return response.choices[0].message.content.strip()

        except RateLimitError as e:
            headers = e.body['metadata']['headers']
            reset_timestamp_ms = headers.get("X-RateLimit-Reset")
            if reset_timestamp_ms:
                reset_timestamp = int(reset_timestamp_ms) / 1000
                wait_time = max(0, reset_timestamp - time.time())
                reset_time_str = datetime.datetime.fromtimestamp(reset_timestamp).strftime('%Y-%m-%d %H:%M:%S')
                print(f"\nüí° –õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω. –û–∂–∏–¥–∞–µ–º –¥–æ {reset_time_str} ({int(wait_time)} —Å–µ–∫—É–Ω–¥)...")
                time.sleep(wait_time + 1)
            else:
                print("‚õî RateLimitError –±–µ–∑ X-RateLimit-Reset. –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥...")
                time.sleep(60)
            



def extract_json_from_text(text):
    #try:
        start = text.find('{')
        end = text.rfind('}') + 1
        json_part = text[start:end]
        return json.loads(json_part)
    #except Exception as e:
     #   print("–û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è JSON:", e)
     #   print("–ò—Å—Ö–æ–¥–Ω—ã–π –æ—Ç–≤–µ—Ç:", text)
      #  return {"–¢–æ—Ä–≥–æ–≤–æ–µ–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ_–¢–ü": "", "–õ–µ–∫–§–æ—Ä–º–∞_–¢–ü": "", "–î–æ–∑–∏—Ä–æ–≤–∫–∞_–¢–ü": "", "–£–ø–∞–∫–æ–≤–∫–∞_–¢–ü": ""}
    

def annotate_batch(index : int, batch: List[Dict[str, str]], headers: List[str]) -> List[Dict]:
    csv_block = rows_to_csv_block(batch, headers)
    user_prompt = f"–†–∞–∑–º–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏, –≤–æ—Ç –≤—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ csv:\n\n{csv_block}"
    response = call_openrouter(MODEL_ANNOTATE, SYSTEM_PROMPT, user_prompt, "–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è " + str(index))
    return response    
    """ try:
        return extract_json_from_text(response)
    except json.JSONDecodeError:
        print("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –ø—Ä–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏.")
        return [] """

def validate_annotations(index : int, annotations: str) -> List[Dict]:
    user_prompt = annotations#json.dumps(annotations, ensure_ascii=False, indent=2)
    response = call_openrouter(MODEL_VALIDATE, validation_system_prompt, user_prompt, "–í–∞–ª–∏–¥–∞—Ü–∏—è " + str(index))
    return response
"""   try:
        parsed = extract_json_from_text(response)
        if isinstance(parsed, list):
            return parsed
        else:
            return []
    except json.JSONDecodeError:
        print("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.")
        return [] """

def save_jsonl(path: str, records: List[Dict]):
    with open(path, 'a', encoding='utf-8') as f:
        for record in records:
            f.write(json.dumps(record, ensure_ascii=False) + '\n')

def append_response(path: str, response: str):
    with open(path, 'a', encoding='utf-8') as f:
        f.write(response + '\n')

def main():
    rows = read_csv_rows(INPUT_FILE)
    headers = list(rows[0].keys())
    batches = batch_rows(rows, BATCH_SIZE)
    start_batch = 389  # –ù–∞—á–∏–Ω–∞–µ–º —Å 65-–π –ø–∞—á–∫–∏
    for i, batch in enumerate(tqdm(batches, desc="–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—á–µ–∫", unit="–ø–∞—á–∫–∞")):
        #print(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—á–∫–∏ {i+1}/{len(batches)}...")
        if (i < start_batch):
            continue
        try :
            print(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—á–∫–∏ {i+1} –∏–∑ {len(batches)}...")
            # –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è
            attempts = 0
            annotated = None
            while attempts < 5:
                annotated = annotate_batch(i, batch, headers)
                if annotated and len(annotated) > 4000:
                    break
                    """ try:
                        extract_json_from_text(annotated)
                        break
                    except json.JSONDecodeError:
                        print("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –ø—Ä–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏. –ü–æ–ø—ã—Ç–∫–∞ "+ str(attempts + 1)) """
                attempts += 1
                current_time = datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')
                print(f"[{current_time}] –û—à–∏–±–∫–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –ø–∞—á–∫–∏ {i} (–¥–ª–∏–Ω–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ {len(annotated)}). –ü–æ–ø—ã—Ç–∫–∞ {attempts} –∏–∑ 5. –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ {100 * attempts * attempts} —Å–µ–∫—É–Ω–¥...")
                time.sleep(100 * attempts * attempts)  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
            if not annotated:
                continue

            # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
            append_response(ANNOTATION_FILE, annotated)

            # –í–∞–ª–∏–¥–∞—Ü–∏—è
        # errors = validate_annotations(i, annotated)
            """ if errors:
                for err in errors:
                    err['batch_index'] = i
                save_jsonl(VALIDATION_ERRORS_FILE, errors) """
            #append_response(VALIDATION_ERRORS_FILE, errors)
        except Exception as e:
            logging.error(traceback.format_exc())
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–∞—á–∫–∏ {i}: {e}")
        time.sleep(1.5)  # –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

if __name__ == '__main__':
    main()
